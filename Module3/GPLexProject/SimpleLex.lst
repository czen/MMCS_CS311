
// ==========================================================================
//  GPLEX error listing for lex source file <SimpleLex.lex>
// ==========================================================================
//  Version:  1.1.3.301
//  Machine:  DESKTOP-T5P0M2C
//  DateTime: 21.09.2018 21:53:36
//  UserName: Alex
// ==========================================================================


%using ScannerHelper;
// Error: ???????? ?? ????? ???? ??????????????.
   // ??? ?????????: stream
// Error: GPLEX: output file <SimpleLex.cs> not opened
// ---------------------------------------------------
%namespace SimpleScanner

Alpha 	[a-zA-Z_]
Digit   [0-9] 
AlphaDigit {Alpha}|{Digit}
INTNUM  {Digit}+
REALNUM {INTNUM}\.{INTNUM}
ID {Alpha}{AlphaDigit}*
DotChr [^\r\n]
OneLineCmnt  \/\/{DotChr}*

// Здесь можно делать описания типов, переменных и методов - они попадают в класс Scanner
%{
  public int LexValueInt;
  public double LexValueDouble;
  public int idCount = 0;
  public int idSumLengths = 0;
  public double idAverageLength;
  public int idMinLength = 10000;
  public int idMaxLength = 0;
  public int intsSum = 0;
  public double doublesSum = 0;
%}

%%
{OneLineCmnt} { 
  return (int)Tok.ONELINECMNT;
}

{INTNUM} { 
  LexValueInt = int.Parse(yytext);
  intsSum += LexValueInt;
  return (int)Tok.INUM;
}

{REALNUM} { 
  LexValueDouble = double.Parse(yytext);
  doublesSum += LexValueDouble;
  return (int)Tok.RNUM;
}

begin { 
  return (int)Tok.BEGIN;
}

end { 
  return (int)Tok.END;
}

cycle { 
  return (int)Tok.CYCLE;
}

{ID}  { 
	++idCount;
	idSumLengths += yyleng;
	if (yyleng < idMinLength)
		idMinLength = yyleng;
	if (yyleng > idMaxLength)
		idMaxLength = yyleng;

  return (int)Tok.ID;
}

":" { 
  return (int)Tok.COLON;
}

":=" { 
  return (int)Tok.ASSIGN;
}

";" { 
  return (int)Tok.SEMICOLON;
}

[^ \r\n] {
	LexError();
	return 0; // конец разбора
}

%%

// Здесь можно делать описания переменных и методов - они тоже попадают в класс Scanner

public void LexError()
{
	Console.WriteLine("({0},{1}): Неизвестный символ {2}", yyline, yycol, yytext);
}

public string TokToString(Tok tok)
{
	switch (tok)
	{
		case Tok.ID:
			return tok + " " + yytext;
		case Tok.INUM:
			return tok + " " + LexValueInt;
		case Tok.RNUM:
			return tok + " " + LexValueDouble;
		default:
			return tok + "";
	}
}

public string IdInfo()
{
	idAverageLength = (double)idSumLengths / idCount;
	return "Count = " + idCount + "\nAverage length = " + idAverageLength + 
		"\nMin length = " + idMinLength + "\nMax length = " + idMaxLength + '\n';
}

public string NumsInfo()
{
	return "Sum ints = " + intsSum + "\nSum doubles = " + doublesSum + '\n';
}// ==========================================================================

